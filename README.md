# Clinic CRM

これはクリニック向けの顧客関係管理（CRM）アプリケーションです。患者とスタッフの両方に機能を提供します。

## 主な機能

### 全体
- **ウェルカムページ**: アプリケーションのランディングページ (`/`)。
- **機能紹介ページ**: サービス機能を紹介するページ (`/features`)。
- **法的ページ**: 特定商取引法に基づく表記 (`/legal/tokushoho`)、プライバシーポリシー (`/privacy-policy`)、会社概要 (`/company`)。
- **お問い合わせフォーム**: 訪問者からの問い合わせ送信フォーム（自動返信メール付き）。
- **日本語化**:
    - Filamentリソースの日本語ラベル対応。
    - 日本語データを含むシーダー（マスタデータ、ダミーデータ）。

### 患者向け機能
- **認証**:
    - ログイン・新規登録機能。
    - **LINE OAuthログイン**: LINEアカウントを使ったソーシャルログイン。
    - 予約フロー内での認証統合。
- **予約管理**:
    - **クリニックコード予約**: 固有URLコード (`/reservation/{code}`) からクリニックを指定して予約。
    - **カレンダー予約**: 空き状況（スタッフ・部屋・機器）を考慮した日時選択。
    - **マイページ**: 予約履歴の確認。
    - メニュー選択から予約完了までのスムーズなフロー。
    - 予約完了メール通知（患者・スタッフ双方）。
- **Web問診**: 予約に紐づく問診フォームへの回答入力。
- **ドキュメント**: マイページから署名済み同意書をダウンロード。

### スタッフ向け機能
- **専用ダッシュボード**: スタッフ専用の管理画面。
- **売上管理**: 売上データの一覧・集計確認。
- **KPIダッシュボード**: 来院数・売上・新規患者数などクリニック経営の主要指標を可視化。
- **患者管理**: 患者情報の登録、表示、更新、削除（CRUD）ができます。
- **ナラティブプロフィール**:
    - 患者の価値観・特性（PatientValue）の記録・更新。
    - 患者価値の非同期自動計算（`PatientValueCalculateJob`）。
    - ライフイベントの登録・削除。
    - ナラティブログ（施術記録・スタッフメモ）の記録。
- **契約管理**:
    - 患者との契約を作成・管理できます。
    - 契約の使用状況を追跡できます。
    - 概要説明済みフラグ（markAsOverviewDelivered）の管理。
    - 契約に紐づいた同意書の作成・送付。
- **スタッフ管理**: スタッフメンバーのアカウントを管理できます。
- **役割管理**: クリニック内の役割（ClinicRole）をCRUDで管理できます。
- **リソース管理**:
    - **メニュー管理**: 施術メニューやサービスのCRUD。部屋タイプ・機器タイプのドロップダウン選択対応。
    - **商品管理**: 販売する商品のCRUD。
    - **部屋管理**: クリニック内の部屋のCRUD。
    - **機器管理**: 医療機器や設備のCRUD。
    - **薬品管理**: 薬品（Medicine）のCRUD。
    - **消耗品管理**: 消耗品（Consumable）のCRUD。
    - **在庫管理**: 在庫の入庫記録・一覧。
- **スケジュール管理**:
    - **シフト管理**: スタッフのシフトを管理できます。
    - **シフト希望申請**: スタッフの希望シフトを収集できます（ShiftRequest）。
    - **シフト自動生成**: スタッフの希望・制約（StaffConstraint）をもとにシフトを自動生成（ShiftGenerationService）。
    - **予約管理**: 患者の予約を一覧で確認・管理できます。
- **キオスクチェックイン**: 受付端末から患者がセルフチェックインできます。
- **ドキュメント管理**:
    - 同意書などのドキュメントテンプレートを管理できます。
    - 患者からデジタル署名を取得できます。
    - 署名済みドキュメントのPDFダウンロード・詳細確認。
- **問診テンプレート管理**: Web問診のテンプレートをCRUDで管理できます（設定メニュー内）。
- **クリニック設定**: クリニック基本情報（名称・連絡先など）の編集。
- **マーケティング機能**:
    - **顧客セグメント**: 条件（PatientFilterService）によって患者をセグメント化して管理できます。
    - **セグメントエクスポート**: セグメントに基づいた患者リストをCSVエクスポートできます。
- **メールシナリオ（ステップメール）**:
    - メールシナリオのCRUD管理。
    - スタッフが手動で患者へシナリオをトリガーできます。
    - フォローアップメールの自動送信（`ScheduleScenarioJob` による定期実行、StepMailLogで進捗追跡）。
- **LINE連携**:
    - 受付スタッフがLINEバインドトークンを発行できます（患者アカウントとLINEの紐付け用）。
    - LINE Messaging APIを通じたLINEメッセージ送信（LineMessagingService）。
    - LINEシナリオの非同期送信（`SendLineScenarioJob`）。
    - LINEウェブフック受信 (`/webhook/line`)。
- **監査ログ**: スタッフが行った操作のログを確認できます。

### Filamentスーパー管理者機能
- クリニック管理
- ユーザー管理（患者アカウント）
- スタッフ管理
- 契約・契約使用状況管理
- ドキュメントテンプレート・署名済みドキュメント管理
- メニュー・商品・部屋・機器管理
- シフト・予約管理
- メールシナリオ管理

## ログイン情報

### 患者用
- **URL**: `/login`
- **Email**: `patient@example.com`
- **Password**: `password`

### スタッフ用
- **URL**: `/staff/login`
- **Email**: `staff@example.com`
- **Password**: `password`

### Filament用
- **URL**: `/NE4SxGSnkpzQB/login`
- **Email**: `kento.takamatsu@meta-alchemist.co.jp`
- **Password**: `ChangeMe123!`
